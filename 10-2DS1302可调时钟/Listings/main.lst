C51 COMPILER V9.57.0.0   MAIN                                                              10/10/2024 09:10:33 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /**
   2          * @brief  利用时钟芯片DS1302使用LCD1602显示时钟，可调时钟
   3            * @param 
   4            * @retval 
   5            */
   6          
   7          
   8          #include <REGX52.h>
   9          #include "LCD1602.h"
  10          #include "DS1302.h"
  11          #include "Key.h"
  12          #include "Timer0.h"
  13          
  14          unsigned char KeyNum,MODE,TimeSelect,TimeSetFlashFlag;
  15          unsigned char Second,Minute;
  16          
  17          void TimeShow(void)
  18          { 
  19   1        
  20   1          DS1302_ReadTime();
  21   1          
  22   1          LCD_ShowNum(1,1,DS1302_Time[0],2);//年
  23   1          LCD_ShowNum(1,4,DS1302_Time[1],2);//月
  24   1          LCD_ShowNum(1,7,DS1302_Time[2],2);//日
  25   1          
  26   1          LCD_ShowNum(2,1,DS1302_Time[3],2);//时
  27   1          LCD_ShowNum(2,4,DS1302_Time[4],2);//分
  28   1          LCD_ShowNum(2,7,DS1302_Time[5],2);//秒
  29   1          
  30   1          LCD_ShowNum(1,11,DS1302_Time[6],1);//星期
  31   1        
  32   1      }
  33          
  34          void TimeSet(void)
  35          {
  36   1        if(KeyNum==2)
  37   1        {
  38   2          TimeSelect++;
  39   2          TimeSelect%=6;//到6自动清零
  40   2        }
  41   1        
  42   1        if(KeyNum==3)
  43   1        {
  44   2          DS1302_Time[TimeSelect]++;
  45   2          if(DS1302_Time[0]>99){DS1302_Time[0]=0;}
  46   2          if(DS1302_Time[1]>12){DS1302_Time[1]=1;}
  47   2          if(DS1302_Time[1]==1||DS1302_Time[1]==3||DS1302_Time[1]==5||DS1302_Time[1]==7||
  48   2            DS1302_Time[1]==8||DS1302_Time[1]==10||DS1302_Time[1]==12)
  49   2          {
  50   3            if(DS1302_Time[2]>31){DS1302_Time[2]=1;}
  51   3          }
  52   2          else if(DS1302_Time[1]==4||DS1302_Time[1]==6||DS1302_Time[1]==9||DS1302_Time[1]==11)
  53   2          {
  54   3            if(DS1302_Time[2]>30){DS1302_Time[2]=1;}
C51 COMPILER V9.57.0.0   MAIN                                                              10/10/2024 09:10:33 PAGE 2   

  55   3          }
  56   2          else if(DS1302_Time[1]==2)
  57   2          {
  58   3            if(DS1302_Time[0]%4==0)
  59   3              {
  60   4                if(DS1302_Time[2]>29){DS1302_Time[2]=1;}
  61   4              }
  62   3              else
  63   3              {
  64   4                if(DS1302_Time[2]>28){DS1302_Time[2]=1;}
  65   4              }
  66   3          }
  67   2          
  68   2          if(DS1302_Time[3]>23){DS1302_Time[3]=0;}
  69   2          if(DS1302_Time[4]>59){DS1302_Time[4]=0;}
  70   2          if(DS1302_Time[5]>59){DS1302_Time[5]=0;}
  71   2        }
  72   1        
  73   1        if(KeyNum==4)
  74   1        {
  75   2          DS1302_Time[TimeSelect]--;
  76   2          if(DS1302_Time[0]<1){DS1302_Time[0]=99;}
  77   2          if(DS1302_Time[1]<1){DS1302_Time[1]=12;}
  78   2          if(DS1302_Time[1]==1||DS1302_Time[1]==3||DS1302_Time[1]==5||DS1302_Time[1]==7||
  79   2            DS1302_Time[1]==8||DS1302_Time[1]==10||DS1302_Time[1]==12)
  80   2          {
  81   3            if(DS1302_Time[2]<1){DS1302_Time[2]=31;}
  82   3            if(DS1302_Time[2]>31){DS1302_Time[2]=1;}
  83   3            
  84   3          }
  85   2          else if(DS1302_Time[1]==4||DS1302_Time[1]==6||DS1302_Time[1]==9||DS1302_Time[1]==11)
  86   2          {
  87   3            if(DS1302_Time[2]<1){DS1302_Time[2]=30;}
  88   3          }
  89   2          else if(DS1302_Time[1]==2)
  90   2          {
  91   3            if(DS1302_Time[0]%4==0)
  92   3              {
  93   4                if(DS1302_Time[2]<1){DS1302_Time[2]=29;}
  94   4                if(DS1302_Time[2]>29){DS1302_Time[2]=1;}
  95   4              }
  96   3              else
  97   3              {
  98   4                if(DS1302_Time[2]<1){DS1302_Time[2]=28;}
  99   4                if(DS1302_Time[2]>28){DS1302_Time[2]=1;}//越界判断
 100   4              }
 101   3          }
 102   2          
 103   2          if(DS1302_Time[3]<0){DS1302_Time[3]=23;}
 104   2          if(DS1302_Time[4]<0){DS1302_Time[4]=59;}
 105   2          if(DS1302_Time[5]<0){DS1302_Time[5]=59;}
 106   2        }
 107   1        //刷新显示
 108   1        if(TimeSelect==0&&TimeSetFlashFlag==1)
 109   1        {
 110   2          LCD_ShowString(1,1,"  ");
 111   2        }
 112   1        else
 113   1        {
 114   2          LCD_ShowNum(1,1,DS1302_Time[0],2);//年
 115   2        }
 116   1          
C51 COMPILER V9.57.0.0   MAIN                                                              10/10/2024 09:10:33 PAGE 3   

 117   1        if(TimeSelect==1&&TimeSetFlashFlag==1)
 118   1        {
 119   2          LCD_ShowString(1,4,"  ");
 120   2        }
 121   1        else
 122   1        {
 123   2          LCD_ShowNum(1,4,DS1302_Time[1],2);//月
 124   2        }
 125   1        if(TimeSelect==2&&TimeSetFlashFlag==1)
 126   1        {
 127   2          LCD_ShowString(1,7,"  ");
 128   2        }
 129   1        else
 130   1        {
 131   2          LCD_ShowNum(1,7,DS1302_Time[2],2);//日
 132   2        }
 133   1        if(TimeSelect==3&&TimeSetFlashFlag==1)
 134   1        {
 135   2          LCD_ShowString(2,1,"  ");
 136   2        }
 137   1        else
 138   1        {
 139   2          LCD_ShowNum(2,1,DS1302_Time[3],2);//时
 140   2        }
 141   1        if(TimeSelect==4&&TimeSetFlashFlag==1)
 142   1        {
 143   2          LCD_ShowString(2,4,"  ");
 144   2        }
 145   1        else
 146   1        {
 147   2          LCD_ShowNum(2,4,DS1302_Time[4],2);//分
 148   2        }
 149   1        if(TimeSelect==5&&TimeSetFlashFlag==1)
 150   1        {
 151   2          LCD_ShowString(2,7,"  ");
 152   2        }
 153   1        else
 154   1        {
 155   2          LCD_ShowNum(2,7,DS1302_Time[5],2);//秒
 156   2        }
 157   1        
 158   1         
 159   1          
 160   1          LCD_ShowNum(1,11,DS1302_Time[6],1);//星期
 161   1        
 162   1         // LCD_ShowNum(2,10,TimeSelect,2);//对调时位置进行选择
 163   1         // LCD_ShowNum(2,15,TimeSetFlashFlag,2);
 164   1      }
 165          
 166          
 167          
 168          
 169          void main()
 170          {
 171   1        LCD_Init();
 172   1        DS1302_Init();
 173   1        Timer0_Init();//定时器初始化
 174   1        
 175   1        LCD_ShowString(1,1,"  -  -  ");
 176   1        LCD_ShowString(2,1,"  :  :  ");
 177   1        
 178   1        DS1302_SetTime();
C51 COMPILER V9.57.0.0   MAIN                                                              10/10/2024 09:10:33 PAGE 4   

 179   1        
 180   1        
 181   1        while(1)
 182   1        {
 183   2          KeyNum=Key();
 184   2          if(KeyNum==1)
 185   2          {
 186   3            if(MODE==0){MODE=1;}
 187   3            else if(MODE==1){MODE=0;DS1302_SetTime();}
 188   3          }
 189   2          switch(MODE)
 190   2          {
 191   3            case 0:TimeShow();break;
 192   3            case 1:TimeSet();break;
 193   3          }
 194   2        
 195   2        }
 196   1      }
 197          
 198          
 199          void Timer0_Routine() interrupt  1
 200          {
 201   1        static unsigned int T0Count;
 202   1        TL0=0x18;
 203   1        TH0=0xFC;//设置定时初值
 204   1        T0Count++;
 205   1        if(T0Count<=1000)
 206   1        {
 207   2          T0Count=0;
 208   2          TimeSetFlashFlag=!TimeSetFlashFlag;
 209   2        }
 210   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    993    ----
   CONSTANT SIZE    =     21    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
